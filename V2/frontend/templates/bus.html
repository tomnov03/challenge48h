<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>En temps réel - Bus Lille</title>
  <link rel="stylesheet" href="../static/style.css">
  <script src="../static/server.js"></script>
  <script>
    async function fetchGTFSData() {
        try {
            const response = await fetch("/api/gtfs");
            const result = await response.json();
            const { lastUpdated, data } = result;

            // Afficher la date de la dernière mise à jour
            document.getElementById("lastUpdated").innerText = `Dernière mise à jour : ${new Date(lastUpdated).toLocaleTimeString()}`;

            let tripsHtml = "<h2>Trajets</h2>";
            data.trips.forEach(trip => {
                tripsHtml += `<div><strong>Trajet ID:</strong> ${trip.trip_id}<ul>`;
                trip.stops.forEach(stop => {
                    tripsHtml += `<li><strong>${stop.stop_name}</strong> (${stop.stop_desc})<br>
                                  Arrêt ID: ${stop.stop_id} <br>
                                  Arrivée: ${stop.arrival_time}, Départ: ${stop.departure_time} <br>
                                  Coordonnées: ${stop.geom || "Non disponible"}
                                  </li>`;
                });
                tripsHtml += `</ul></div>`;
            });
            document.getElementById("trips").innerHTML = tripsHtml;
        } catch (err) {
            console.error("Erreur lors de la récupération des données GTFS :", err);
        }
    }

    window.onload = () => {
        fetchGTFSData(); // Appel immédiat à l'API pour charger les données à l'ouverture
    };
</script>

</head>


  <header>
    <div class="logo">
      <img src="../image/logomel.jpg" alt="Logo de la Métropole Européenne de Lille">
      <strong>MÉTROPOLE EUROPÉENNE DE LILLE</strong>
    </div>
    <nav>
      <ul>
        <div class="Title-Article">
          <li><a href="./">Accueil</a></li>
          <li><a>Les lignes ▾</a>
              <ul>
                <li><a href="./ligne1.html">Métro Ligne 1</a></li>
                <li><a href="./ligne2.html">Métro Ligne 2</a></li>
              </ul>
          </li>
          <li><a href="./bus.html">Bus en temps réel</a></li>
          <li><a> Les travaux ▾</a>
            <ul>
              <li><a href="./article1.html">Euralille 3000</a></li>
              <li><a href="./article2.html">15 nouvelles rames...</a></li>
              <li><a href="./article3.html">Ligne 1 du métro...</a></li>
            </ul>
          </li>
        </div>
      </ul>
    </nav>
  </header>

  <body>
  <h1>Informations en temps réel</h1>
    <p id="lastUpdated">Chargement...</p>
    <div id="trips"></div>

</body>
</html>
